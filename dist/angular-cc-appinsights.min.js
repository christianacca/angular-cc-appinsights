var cc;!function(cc){var appinsights;!function(appinsights){"use strict";angular.module("cc-appinsights",[])}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";var AppInsightsProvider=function(){function AppInsightsProvider(_$provide,_$httpProvider){this._$provide=_$provide,this._$httpProvider=_$httpProvider,this.configOptions={},this.defaultOptions={autoRun:!0,autoTrackExceptions:!0,autoTrackPageViews:!0,addPageViewCorrelationHeader:!1,ajaxTelemetryInitializers:[],pageViewTelemetryInitializers:["ccDefaultPageViewTelemetryInitializer"],telemetryInitializers:[]},this.$get.$inject=["$injector"],this._decorateExceptionHandler.$inject=["$delegate","$window"]}return AppInsightsProvider.prototype.$get=function($injector){return $injector.instantiate(appinsights.AppInsights,{configOptions:this.configOptions})},AppInsightsProvider.prototype.configure=function(options){this.configOptions=this._extend(this.configOptions,this.defaultOptions,options),this.configOptions.autoTrackExceptions&&this._$provide.decorator("$exceptionHandler",this._decorateExceptionHandler),this.configOptions.addPageViewCorrelationHeader&&this._$httpProvider.interceptors.push("ccAppInsightsHttpInterceptor")},AppInsightsProvider.prototype._decorateExceptionHandler=function($delegate,$window){return function(exception,cause){if($delegate(exception,cause),$window.appInsights)try{$window.appInsights.trackException(exception)}catch(ex){$delegate(ex,"Application Insights")}}},AppInsightsProvider.prototype._extend=function(target){for(var sources=[],_i=1;_i<arguments.length;_i++)sources[_i-1]=arguments[_i];for(var i=0;i<sources.length;i++){var source=sources[i]||{};for(var prop in source)source.hasOwnProperty(prop)&&(target[prop]=source[prop])}return target},AppInsightsProvider.$inject=["$provide","$httpProvider"],AppInsightsProvider}();appinsights.AppInsightsProvider=AppInsightsProvider,angular.module("cc-appinsights").provider("ccAppInsights",AppInsightsProvider)}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";var AppInsights=function(){function AppInsights(_$rootScope,_$location,_$window,configOptions,_$injector){this._$rootScope=_$rootScope,this._$location=_$location,this._$window=_$window,this.configOptions=configOptions,this._$injector=_$injector,this._hasRun=!1,this._appInsights=_$window.appInsights,this.service=_$window.appInsights}return AppInsights.prototype.run=function(){var _this=this;!this._hasRun&&this._appInsights&&(this._hasRun=!0,this._addTelemetryInitializers(this.configOptions.pageViewTelemetryInitializers||[],function(envelope){return _this._isPageViewTelemetryItem(envelope)}),this._addTelemetryInitializers(this.configOptions.ajaxTelemetryInitializers||[],function(envelope){return _this._isAjaxTelemetryItem(envelope)}),this._addTelemetryInitializers(this.configOptions.telemetryInitializers||[]),this.configOptions.autoTrackPageViews&&this._autoTrackPageViews())},AppInsights.prototype._addTelemetryInitializers=function(initializers,condition){var _this=this;initializers&&initializers.forEach(function(initializer){"string"==typeof initializer&&(initializer=_this._$injector.get(initializer));var ti=null!=condition?_this._createConditionalTelemetryInitializer(initializer,condition):initializer;_this._appInsights.context.addTelemetryInitializer(ti)})},AppInsights.prototype._autoTrackPageViews=function(){var _this=this;this._$rootScope.$on("$routeChangeStart",function(evt,next){_this._trackNewPage(evt,next)}),this._$rootScope.$on("$routeChangeSuccess",function(evt,current){_this._recordPageView(evt,current)}),this._$rootScope.$on("$routeChangeError",function(evt,route){_this._recordPageView(evt,route),_this._appInsights.context.operation=_this._previousOperation})},AppInsights.prototype._createConditionalTelemetryInitializer=function(initializer,condition){return function(envelope){return condition(envelope)?initializer.apply(null,arguments):void 0}},AppInsights.prototype._isPageViewTelemetryItem=function(envelope){return envelope.name===Microsoft.ApplicationInsights.Telemetry.PageView.envelopeType},AppInsights.prototype._isAjaxTelemetryItem=function(envelope){return envelope.name===Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType&&envelope.data.baseData.dependencyKind===AI.DependencyKind.Http},AppInsights.prototype._recordPageView=function(evt,route){null!=this._pageInProgress&&this._appInsights.stopTrackPage(this._pageInProgress.name,this._pageInProgress.url)},AppInsights.prototype._trackNewPage=function(evt,route){if(!route||null!=route.redirectTo)return void(this._pageInProgress=null);this._pageInProgress={name:this._$location.path()||"/",url:this._$location.url()||"/"};var newOperation=new this._$window.Microsoft.ApplicationInsights.Context.Operation;newOperation.name=this._pageInProgress.name,this._previousOperation=this._appInsights.context.operation,this._appInsights.context.operation=newOperation,this._appInsights.startTrackPage(this._pageInProgress.name)},AppInsights.$inject=["$rootScope","$location","$window","configOptions","$injector"],AppInsights}();appinsights.AppInsights=AppInsights}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict"}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";var AppInsightsHttpInterceptor=function(){function AppInsightsHttpInterceptor(appInsights){var _this=this;this._impl=appInsights.service,"string"==typeof appInsights.configOptions.addPageViewCorrelationHeader?this._pageViewIdHeaderKey=appInsights.configOptions.addPageViewCorrelationHeader:this._pageViewIdHeaderKey="ai-pv-opid",this.request=this._impl?function(config){return _this._addHeaders(config)}:angular.identity}return AppInsightsHttpInterceptor.prototype._addHeaders=function(config){return config.headers&&this._impl&&(config.headers[this._pageViewIdHeaderKey]=this._impl.context.operation.id),config},AppInsightsHttpInterceptor.$inject=["ccAppInsights"],AppInsightsHttpInterceptor}();angular.module("cc-appinsights").service("ccAppInsightsHttpInterceptor",AppInsightsHttpInterceptor)}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";function defaultPageViewTelemetryInitializer($route){function parseControllerName(name){return"string"!=typeof name?null:name.split(" as")[0]}function setPageViewProperties(envelope){if($route.current){var pageView=envelope.data.baseData;pageView.properties=pageView.properties||{},pageView.properties.controller=parseControllerName($route.current.controller),pageView.properties.routePath=$route.current.originalPath||"/"}}return setPageViewProperties}angular.module("cc-appinsights").factory("ccDefaultPageViewTelemetryInitializer",defaultPageViewTelemetryInitializer),defaultPageViewTelemetryInitializer.$inject=["$route"]}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";function maybeAutoRun(appInsights){appInsights.configOptions.autoRun&&appInsights.run()}angular.module("cc-appinsights").run(maybeAutoRun),maybeAutoRun.$inject=["ccAppInsights"]}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));
//# sourceMappingURL=dist/angular-cc-appinsights.min.js.map