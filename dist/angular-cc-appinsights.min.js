var cc;!function(cc){var appinsights;!function(appinsights){"use strict";angular.module("cc-appinsights",[])}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";var AppInsightsProvider=function(){function AppInsightsProvider($provide,$httpProvider){this.$provide=$provide,this.$httpProvider=$httpProvider,this.configOptions={},this.defaultOptions={autoRun:!0,autoTrackExceptions:!0,autoTrackPageViews:!0,addPageViewCorrelationHeader:!1,ajaxTelemetryInitializers:[],pageViewTelemetryInitializers:["ccDefaultPageViewTelemetryInitializer"],telemetryInitializers:[]},this.$get.$inject=["$injector"],this.decorateExceptionHandler.$inject=["$delegate","$window"]}return AppInsightsProvider.prototype.$get=function($injector){return $injector.instantiate(appinsights.AppInsights,{configOptions:this.configOptions})},AppInsightsProvider.prototype.configure=function(options){this.configOptions=this.extend(this.configOptions,this.defaultOptions,options),this.configOptions.autoTrackExceptions&&this.$provide.decorator("$exceptionHandler",this.decorateExceptionHandler),this.configOptions.addPageViewCorrelationHeader&&this.$httpProvider.interceptors.push("ccAppInsightsHttpInterceptor")},AppInsightsProvider.prototype.decorateExceptionHandler=function($delegate,$window){return function(exception,cause){if($delegate(exception,cause),$window.appInsights)try{$window.appInsights.trackException(exception)}catch(ex){$delegate(ex,"Application Insights")}}},AppInsightsProvider.prototype.extend=function(target){for(var sources=[],_i=1;_i<arguments.length;_i++)sources[_i-1]=arguments[_i];for(var i=0;i<sources.length;i++){var source=sources[i]||{};for(var prop in source)source.hasOwnProperty(prop)&&(target[prop]=source[prop])}return target},AppInsightsProvider.$inject=["$provide","$httpProvider"],AppInsightsProvider}();appinsights.AppInsightsProvider=AppInsightsProvider,angular.module("cc-appinsights").provider("ccAppInsights",AppInsightsProvider)}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";var AppInsights=function(){function AppInsights($rootScope,$location,$window,configOptions,$injector){this.$rootScope=$rootScope,this.$location=$location,this.$window=$window,this.configOptions=configOptions,this.$injector=$injector,this.hasRun=!1,this.appInsights=$window.appInsights,this.service=$window.appInsights}return AppInsights.prototype.run=function(){var _this=this;!this.hasRun&&this.appInsights&&(this.hasRun=!0,this.addTelemetryInitializers(this.configOptions.pageViewTelemetryInitializers||[],function(envelope){return _this.isPageViewTelemetryItem(envelope)}),this.addTelemetryInitializers(this.configOptions.ajaxTelemetryInitializers||[],function(envelope){return _this.isAjaxTelemetryItem(envelope)}),this.addTelemetryInitializers(this.configOptions.telemetryInitializers||[]),this.configOptions.autoTrackPageViews&&this.autoTrackPageViews())},AppInsights.prototype.addTelemetryInitializers=function(initializers,condition){var _this=this;initializers&&initializers.forEach(function(initializer){"string"==typeof initializer&&(initializer=_this.$injector.get(initializer));var ti=null!=condition?_this.createConditionalTelemetryInitializer(initializer,condition):initializer;_this.appInsights.context.addTelemetryInitializer(ti)})},AppInsights.prototype.autoTrackPageViews=function(){var _this=this;this.$rootScope.$on("$routeChangeStart",function(evt,next){_this.trackNewPage(evt,next)}),this.$rootScope.$on("$routeChangeSuccess",function(evt,current){_this.recordPageView(evt,current)}),this.$rootScope.$on("$routeChangeError",function(evt,route){_this.recordPageView(evt,route),_this.appInsights.context.operation=_this.previousOperation})},AppInsights.prototype.createConditionalTelemetryInitializer=function(initializer,condition){return function(envelope){return condition(envelope)?initializer.apply(null,arguments):void 0}},AppInsights.prototype.isPageViewTelemetryItem=function(envelope){return envelope.name===Microsoft.ApplicationInsights.Telemetry.PageView.envelopeType},AppInsights.prototype.isAjaxTelemetryItem=function(envelope){return envelope.name===Microsoft.ApplicationInsights.Telemetry.RemoteDependencyData.envelopeType&&envelope.data.baseData.dependencyKind===AI.DependencyKind.Http},AppInsights.prototype.recordPageView=function(evt,route){null!=this.pageInProgress&&this.appInsights.stopTrackPage(this.pageInProgress.name,this.pageInProgress.url)},AppInsights.prototype.trackNewPage=function(evt,route){if(!route||null!=route.redirectTo)return void(this.pageInProgress=null);this.pageInProgress={name:this.$location.path()||"/",url:this.$location.url()||"/"};var newOperation=new this.$window.Microsoft.ApplicationInsights.Context.Operation;newOperation.name=this.pageInProgress.name,this.previousOperation=this.appInsights.context.operation,this.appInsights.context.operation=newOperation,this.appInsights.startTrackPage(this.pageInProgress.name)},AppInsights.$inject=["$rootScope","$location","$window","configOptions","$injector"],AppInsights}();appinsights.AppInsights=AppInsights}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict"}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";var AppInsightsHttpInterceptor=function(){function AppInsightsHttpInterceptor(appInsights){var _this=this;this.impl=appInsights.service,"string"==typeof appInsights.configOptions.addPageViewCorrelationHeader?this.pageViewIdHeaderKey=appInsights.configOptions.addPageViewCorrelationHeader:this.pageViewIdHeaderKey="ai-pv-opid",this.request=this.impl?function(config){return _this.addHeaders(config)}:angular.identity}return AppInsightsHttpInterceptor.prototype.addHeaders=function(config){return config.headers&&this.impl&&(config.headers[this.pageViewIdHeaderKey]=this.impl.context.operation.id),config},AppInsightsHttpInterceptor.$inject=["ccAppInsights"],AppInsightsHttpInterceptor}();angular.module("cc-appinsights").service("ccAppInsightsHttpInterceptor",AppInsightsHttpInterceptor)}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";function defaultPageViewTelemetryInitializer($route){function parseControllerName(name){return"string"!=typeof name?null:name.split(" as")[0]}function setPageViewProperties(envelope){if($route.current){var pageView=envelope.data.baseData;pageView.properties=pageView.properties||{},pageView.properties.controller=parseControllerName($route.current.controller),pageView.properties.routePath=$route.current.originalPath||"/"}}return setPageViewProperties}angular.module("cc-appinsights").factory("ccDefaultPageViewTelemetryInitializer",defaultPageViewTelemetryInitializer),defaultPageViewTelemetryInitializer.$inject=["$route"]}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));var cc;!function(cc){var appinsights;!function(appinsights){"use strict";function maybeAutoRun(appInsights){appInsights.configOptions.autoRun&&appInsights.run()}angular.module("cc-appinsights").run(maybeAutoRun),maybeAutoRun.$inject=["ccAppInsights"]}(appinsights=cc.appinsights||(cc.appinsights={}))}(cc||(cc={}));
//# sourceMappingURL=dist/angular-cc-appinsights.min.js.map